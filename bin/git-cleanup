#!/bin/bash

# Git Cleanup Script - Handles squashed branches
# Usage: ./bin/git-cleanup

echo "ğŸ§¹ Starting Git cleanup..."

# 1. Switch to master
echo "ğŸ“ Switching to master..."
git checkout master

# 2. Pull latest changes from origin
echo "â¬‡ï¸  Pulling latest from origin/master..."
git pull origin master

# 3. Fetch and prune deleted remote branches
echo "ğŸ—‘ï¸  Pruning deleted remote branches..."
git fetch -p

# 4. Delete local branches that are merged
echo "ğŸ” Deleting merged branches..."
git branch --merged | grep -v "\*" | grep -v "master" | grep -v "main" | xargs -n 1 git branch -d 2>/dev/null

# 5. List branches that might be safe to delete (remote is gone)
echo ""
echo "ğŸ“‹ Local branches with deleted remotes (safe to delete manually):"
git branch -vv | grep ': gone]' | awk '{print $1}'

# 6. Optional: Delete branches with gone remotes automatically
echo ""
read -p "â“ Delete branches with deleted remotes? (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    git branch -vv | grep ': gone]' | awk '{print $1}' | xargs -n 1 git branch -D
    echo "âœ… Deleted branches with gone remotes"
fi

echo ""
echo "âœ¨ Cleanup complete!"
echo ""
echo "ğŸ“Š Remaining branches:"
git branch
